\documentclass{./src/gm2}

% \setlength{\titleblockheight}{10cm}%adjust this lenght if it is needed

\usepackage[english]{babel}
\usepackage[utf8]{inputenc}
\usepackage{amsmath,amssymb,amsfonts,bm}
\usepackage{mathrsfs,overpic}
\usepackage[href]{./src/journals}
\usepackage{lscape,xspace}
\usepackage{subfigure}
\usepackage{morefloats}
\usepackage{booktabs}
\usepackage{adjustbox}
\usepackage{graphicx}
%\usepackage{showframe}   

\newcommand{\overbar}[1]{\mkern+2mu\overline{\mkern-2mu#1\mkern-1mu} \mkern+1mu}
\renewcommand{\epsilon}{\varepsilon}
\renewcommand{\rho}{\varrho}
\newcommand{\p}{\ensuremath{\bm{p}}}
\newcommand{\re}{\ensuremath{\Re {\rm e}}}
\newcommand{\im}{\ensuremath{\Im {\rm m}}}
\newcommand{\mean}[1]{\ensuremath{\langle #1 \rangle}}
\newcommand{\bra}[1]{\ensuremath{\langle#1|}}
\newcommand{\ket}[1]{\ensuremath{|#1\rangle}}
\newcommand{\mup}{\mbox{\ensuremath{\mu^+}}}
\newcommand{\mum}{\mbox{\ensuremath{\mu^-}}}
%\newcommand{\MeVc}{\mbox{\ensuremath{\text{MeV}/c}}}
%\newcommand{\GeVc}{\mbox{\ensuremath{\text{GeV}/c}}}
\newcommand{\geant}{{\tt GEANT}}
\newcommand{\wfd}{{\tt WFD}}
\newcommand{\orcad}{{\tt OrCAD}}
\newcommand{\opera}{{\tt OPERA}}
\newcommand{\mars}{{\tt MARS}}
\newcommand{\gbeamline}{{\tt G4Beamline}}
\newcommand{\ea}{{\em et al.}}
\newcommand{\amu}[1][]{\ensuremath{a_{\mu^{#1}}}}
\newcommand{\gm}{\ensuremath{(g-2)}}
\newcommand{\wa}{\mbox{\ensuremath{\omega_a}}}
\renewcommand{\wp}{\mbox{\ensuremath{\omega_p}}}
\newcommand{\wpt}{\mbox{\ensuremath{\widetilde{\omega}_p}}}
\newcommand{\mus}{\mbox{\ensuremath{\mu\text{s}}}}
\newcommand{\Exp}{\mbox{New \g2\ Experiment}}

%% Physics
\newcommand{\xxx}{\textcolor{green}{XXX}\xspace}

\begin{document}

%opening
\title{Extraction of the muon beam frequency distribution via the Fourier analysis of the fast rotation signal}
\noteid{G-2 Internal}
\version{1.0}
\author[1]{\mail{antoine.chapelain@cornell.edu}{A.~Chapelain}}
\author[1]{\mail{seungcheon.kim@cornell.edu}{SC.~Kim}}
\author[1]{\mail{david.rubin@cornell.edu}{D.~Rubin}}
\author[1]{\mail{dms525@cornell.edu}{D.~Seleznev}}

\affil[1]{Cornell University}

\maketitle

\tableofcontents

\section{Introduction}

\section{Fast Rotation}

Imagine that the initial distribution has zero emittance, zero energy spread and zero bunch length. The particles share a common revolution period $T$ and the time dependence of the intensity signal at a fixed point is 

\begin{equation}
I(t)=\delta\left(t-\left(n+\frac{\theta}{2\pi}\right)T\right)
\end{equation} 
where $n$ is any non negative integer and $\theta$ is the azimuthal position of the point in the ring. A particle with energy offset $\Delta$ will have revolution period $T(1+\Delta)$, so that 
\begin{equation}
I(t,\Delta)=\delta\left(t-\left(n+\frac{\theta}{2\pi}\right)T\left(1+\Delta\right)\right) 
\end{equation}
The fast rotation signal at the point is then 
\begin{equation}
S(t)=\sum^{\infty}_{n=0}\int\rho(\Delta)\delta\left(t-\left(n+\frac{\theta}{2\pi}\right)T\left(1+\Delta\right)\right)d\Delta 
\end{equation}
where $\rho(\Delta)$ is the distribution of momenta offsets. If the energy distribution is a Gaussian with width $\Delta_0$, then 
\begin{equation}
S(t)=\sum^{\infty}_{n=0}\int\frac{e^{-\Delta^2/(2\Delta^2_0)}}{\sqrt{2\pi}\Delta_0}\delta\left(t-\left(n+\frac{\theta}{2\pi}\right)T\left(1+\Delta\right)\right)d\Delta\]\[=\sum^{\infty}_{n=0}\int\frac{e^{-\Delta^2/(2\Delta^2_0)}}{\sqrt{2\pi}\Delta_0}\frac{\delta\left(\Delta-\left(\frac{t}{(n+\theta/2\pi)T}-1\right)\right)}{(n+\theta/2\pi)T}d\Delta\]\[=\sum^{\infty}_{n=0}\frac{\exp[-(\frac{t}{(n+\theta/2\pi)T}-1)^2/2\Delta^2_0]}{\sqrt{2\pi}\Delta_0(n+\theta/2\pi)T}\]\[=\sum^{\infty}_{n=0}\frac{\exp[-(t-(n+\theta/2\pi)T)^2/2\Delta^2_0(n+\theta/2\pi)^2T^2]}{\sqrt{2\pi}\Delta_0(n+\theta/2\pi)T}
\end{equation}

Using the fact that $\theta/2\pi=t_0/T$, we rewrite $(4)$ as 
\begin{equation}
\sum^{\infty}_{n=0}\frac{e^{-(t-(nT+t_0))^2/2\Delta^2_0(nT+t_0)^2}}{\sqrt{2\pi}\Delta_0(nT+t_0)}
\end{equation}

\subsection{Momentum distribution from fast rotation signal}

The established method for extracting the energy (or equivalently the frequency distribution) is to take the real part of the Fourier transform of the fast rotation signal. Suppose the center of mass of the muon beam first passes the detector at time $t_0$, and the detector starts detecting at some time $t_s>t_0$.  Let $S(t)$ be the fast rotation signal of a muon beam with Gaussian momentum distribution. Then  
\begin{equation}
F(\omega)=\int^{\infty}_{t_s}S(t)\cos\omega(t-t_0) dt\] \[=\sum^{\infty}_{n=0}\int^{\infty}_{t_s}\frac{e^{-(t-(nT+t_0))^2/2\Delta^2_0(nT+t_0)^2}}{\sqrt{2\pi}\Delta_0(nT+t_0)}\cos\omega(t-t_0)dt\] \[=\sum^{\infty}_{n=0}\frac{e^{-1/2\Delta^2_0}}{2\sqrt{2\pi}\Delta_0(nT+t_0)}\int^{\infty}_{t_s}e^{-t^2/2\Delta^2_0(nT+t_0)^2}e^{t/(nT+t_0)\Delta^2_0}e^{\pm i\omega t}e^{\mp i\omega t_0}dt
\end{equation}

From Gradshteyn and Rizhik, we know that 
\begin{equation}
\int^{\infty}_u\exp\left(-\frac{x^2}{4\beta}-\gamma x\right)dx=\sqrt{\pi\beta}e^{\beta\gamma^2}\left(1-\frac{\sqrt{\pi}}{2}\text{Erf}\left(\gamma\sqrt{\beta}+\frac{u}{2\sqrt{\beta}}\right)\right)
\end{equation}
for $\text{Re}(\beta)>0$ and $u\geq0$. Thus the result of using this integral in computing the Fourier transform is $\tilde{F}(\omega)=$ 

\begin{equation}
\sum^{\infty}_{n=0}\frac{e^{-\omega^2(nT+t_0)^2\Delta^2_0/2}e^{i\omega nT}}{4}\left(1-\frac{\sqrt{\pi}}{2}\text{Erf}\left[\frac{-1}{\Delta_0\sqrt{2}}-\frac{i\omega (nT+t_0)\Delta_0}{\sqrt{2}}+\frac{t_s}{\Delta_0(nT+t_0)\sqrt{2}}\right]\right)+\] \[\sum^{\infty}_{n=0}\frac{e^{-\omega^2(nT+t_0)^2\Delta^2_0/2}e^{-i\omega nT}}{4}\left(1-\frac{\sqrt{\pi}}{2}\text{Erf}\left[\frac{-1}{\Delta_0\sqrt{2}}+\frac{i\omega (nT+t_0)\Delta_0}{\sqrt{2}}+\frac{t_s}{\Delta_0(nT+t_0)\sqrt{2}}\right]\right)
\end{equation}

Something to note about $(5)$ is that if we start the sum from say, index $j-1$, then the first $j-1$ spikes of the signal, corresponding to the detector seeing the beam the first $j-1$ turns, will disappear. So the observed signal may be written as \[\sum^{\infty}_{n=j}\frac{\exp[-(t-(nT+t_0))^2/2\Delta^2_0(nT+t_0)^2T^2]}{\sqrt{2\pi}\Delta_0(nT+t_0)T}\] Reindexing the sum gives us \[\sum^{\infty}_{n=0}\frac{\exp[-(t-((n+j)T+t_0))^2/2\Delta^2_0((n+j)T+t_0)^2T^2]}{\sqrt{2\pi}\Delta_0((n+j)T+t_0)T}\] Given $t_s$, $t_0$, and $T$, the corresponding starting index in the expression for $S(t)$ is $m=\lceil{(t_s-t_0)/T}\rceil$. Hence the immediately observed frequency spectrum can also be expressed as $\tilde{F}(\omega)=$ 

\begin{equation}
\sum^{\infty}_{n=m}\frac{e^{-\omega^2(nT+t_0)^2\Delta^2_0/2}e^{i\omega nT}}{4}\left(1-\frac{\sqrt{\pi}}{2}\text{Erf}\left[\frac{-1}{\Delta_0\sqrt{2}}-\frac{i\omega (nT+t_0)\Delta_0}{\sqrt{2}}+\frac{t_s}{\Delta_0(nT+t_0)\sqrt{2}}\right]\right)+\] \[\sum^{\infty}_{n=m}\frac{e^{-\omega^2(nT+t_0)^2\Delta^2_0/2}e^{-i\omega nT}}{4}\left(1-\frac{\sqrt{\pi}}{2}\text{Erf}\left[\frac{-1}{\Delta_0\sqrt{2}}+\frac{i\omega (nT+t_0)\Delta_0}{\sqrt{2}}+\frac{t_s}{\Delta_0(nT+t_0)\sqrt{2}}\right]\right)
\end{equation}

\subsection{Corrections to the Fourier transform} The detector in the section above started to detect the muon beam at a time $t_s>t_0$. In the time that the detector does not detect the beam, some decoherence of the fast rotation signal occurs, resulting in lost frequency content in the Fourier transform above. This results in distortions of the frequency spectrum.  Consider the integral of $S(t)$ between times $t_0$ and $t_s$: 
\begin{equation}
\Delta(\omega)=\int^{t_s}_{t_0}S(t)\cos\omega(t-t_0)dt
\end{equation}

This is the part of the frequency spectrum that the detector fails to account for. Let's take a closer look at $\Delta$. \[\Delta(\omega)=\int^{t_s}_{t_0}S(t)\cos\omega(t-t_0)dt\]\[=\int^{\infty}_{t_0}S(t)\cos\omega(t-t_0)dt-\int^{\infty}_{t_s}S(t)\cos\omega(t-t_0)dt\] Using the integral given in Gradshteyn and Ryzhik, we have 

\begin{equation}
\sum^{\infty}_{n=0}\frac{e^{-\omega^2(nT+t_0)^2\Delta^2_0/2}e^{i\omega nT}}{4}\left(1-\frac{\sqrt{\pi}}{2}\text{Erf}\left[\frac{-1}{\Delta_0\sqrt{2}}-\frac{i\omega (nT+t_0)\Delta_0}{\sqrt{2}}+\frac{t_0}{\Delta_0(nT+t_0)\sqrt{2}}\right]\right)+\] \[\sum^{\infty}_{n=0}\frac{e^{-\omega^2(nT+t_0)^2\Delta^2_0/2}e^{-i\omega nT}}{4}\left(1-\frac{\sqrt{\pi}}{2}\text{Erf}\left[\frac{-1}{\Delta_0\sqrt{2}}+\frac{i\omega (nT+t_0)\Delta_0}{\sqrt{2}}+\frac{t_0}{\Delta_0(nT+t_0)\sqrt{2}}\right]\right)\]\[-\sum^{\infty}_{n=0}\frac{e^{-\omega^2(nT+t_0)^2\Delta^2_0/2}e^{i\omega nT}}{4}\left(1-\frac{\sqrt{\pi}}{2}\text{Erf}\left[\frac{-1}{\Delta_0\sqrt{2}}-\frac{i\omega (nT+t_0)\Delta_0}{\sqrt{2}}+\frac{t_s}{\Delta_0(nT+t_0)\sqrt{2}}\right]\right)+\] \[-\sum^{\infty}_{n=0}\frac{e^{-\omega^2(nT+t_0)^2\Delta^2_0/2}e^{-i\omega nT}}{4}\left(1-\frac{\sqrt{\pi}}{2}\text{Erf}\left[\frac{-1}{\Delta_0\sqrt{2}}+\frac{i\omega (nT+t_0)\Delta_0}{\sqrt{2}}+\frac{t_s}{\Delta_0(nT+t_0)\sqrt{2}}\right]\right)
\end{equation}

But keeping in mind the reasoning leading to $(9)$, we may instead write $\Delta(\omega)=$
\begin{equation}
\sum^{m-1}_{n=0}\frac{e^{-\omega^2(nT+t_0)^2\Delta^2_0/2}e^{i\omega nT}}{4}\left(1-\frac{\sqrt{\pi}}{2}\text{Erf}\left[\frac{-1}{\Delta_0\sqrt{2}}-\frac{i\omega (nT+t_0)\Delta_0}{\sqrt{2}}+\frac{t_0}{\Delta_0(nT+t_0)\sqrt{2}}\right]\right)\] \[+\sum^{m-1}_{n=0}\frac{e^{-\omega^2(nT+t_0)^2\Delta^2_0/2}e^{-i\omega nT}}{4}\left(1-\frac{\sqrt{\pi}}{2}\text{Erf}\left[\frac{-1}{\Delta_0\sqrt{2}}+\frac{i\omega (nT+t_0)\Delta_0}{\sqrt{2}}+\frac{t_0}{\Delta_0(nT+t_0)\sqrt{2}}\right]\right)\]\[-\sum^{m-1}_{n=0}\frac{e^{-\omega^2(nT+t_0)^2\Delta^2_0/2}e^{i\omega nT}}{4}\left(1-\frac{\sqrt{\pi}}{2}\text{Erf}\left[\frac{-1}{\Delta_0\sqrt{2}}-\frac{i\omega (nT+t_0)\Delta_0}{\sqrt{2}}+\frac{t_s}{\Delta_0(nT+t_0)\sqrt{2}}\right]\right)\] \[-\sum^{m-1}_{n=0}\frac{e^{-\omega^2(nT+t_0)^2\Delta^2_0/2}e^{-i\omega nT}}{4}\left(1-\frac{\sqrt{\pi}}{2}\text{Erf}\left[\frac{-1}{\Delta_0\sqrt{2}}+\frac{i\omega (nT+t_0)\Delta_0}{\sqrt{2}}+\frac{t_s}{\Delta_0(nT+t_0)\sqrt{2}}\right]\right)
\end{equation}

In the vicinity of the magic frequency, $\Delta$ is expected to be parabolic. Looking at the figures below, we can see that this is indeed true.

\subsection{Investigation of the Established Method for Extracting $\Delta$}

The established method for extracting $\Delta$ asserts that we may extract it by using $\tilde{F}(\omega)$. We have that  \[\Delta(\omega)=\int^{t_s}_{t_0}S(t)\cos\omega(t-t_0)dt\] The idea is that although we do not observe $S(t)$ for times $t_0<t<t_s$, we may reasonably approximate $S(t)$ on this interval of time:\[S(t)=\int \tilde{F}(f')\cos2\pi f'(t-t_0)df'\] Substituting this expression for $S(t)$ into the integral for $\Delta$, we have \[\Delta(f)=\iint^{t_s}_{t_0}\tilde{F}(f')\cos2\pi f'(t-t_0)\cos2\pi f(t-t_0)dtdf'=\]\[\frac{A}{2\pi^2}\int \tilde{F}(f')\left(\frac{\sin2\pi(f-f')(t_s-t_0)}{f-f'}+\frac{\sin2\pi(f+f')(t_s-t_0)}{f+f'}\right)df'\] We may ignore the second term in the parentheses as their contribution is negligible. Thus \[\Delta(f,t_s)=\frac{A}{2\pi^2}\int \tilde{F}(f')\frac{\sin2\pi(f-f')(t_s-t_0)}{f-f'}df'\]


The established method for extracting $\Delta$ asserts that we may get \[\Delta(\omega)=2\pi(t_s-t_0)\int^{\infty}_{-\infty}F(\omega')\frac{\sin(\omega-\omega')(t_s-t_0)}{(\omega-\omega')(t_s-t_0)}d\omega'\] where $F(\omega')$ is the frequency distribution extracted from the immediate detector data, with no corrections applied. For small $\omega-\omega')(t_s-t_0)$, we may approximate the integral using the fact that $\text{sinc}(x)=1-x^2/6$ for $x<<1$. Then \[\Delta(\omega)\approx2\pi(t_s-t_0)\int^{\infty}_{-\infty}F(\omega')\left(1-\frac{(\omega-\omega')^2(t_s-t_0)^2}{6}\right)d\omega'\]\[=2\pi(t_s-t_0)\int^{\infty}_{-\infty}F(\omega')d\omega'-\frac{2\pi(t_s-t_0)^3}{6}\int^{\infty}_{-\infty}F(\omega')(\omega^2-2\omega\omega'+\omega'^2)d\omega'\]

\end{document}
